import numpy as np
from matplotlib import pyplot as plt
import matplotlib.lines as mlines
from vars import *


sample_sizes = [1000, 3000, 5000, 7500, 10000, 12500, 15000][1:]
sim = "sim2"

s_mse_train = [50.10423022471699, 3.958625342547647, 3.3944347279921727, 3.0227234491536206, 2.9688575136940996, 2.830573747728954, 2.903638678744957]
t_mse_train = [33.38460876358694, 3.2493429842562787, 4.057565799938603, 3.3142969930291115, 3.345657316012884, 3.194359211628418, 3.099359698914721]
tarnet_mse_train = [728.4996605859576, 18.304694818704476, 8.041160941097898, 6.4123775731382135, 5.888966688361795, 5.752459963473915, 5.266193601503675]
cfr_mse_train = [766.4522501574139, 18.38822053951671, 7.6892398617255875, 6.572657616642755, 5.995299332264855, 5.5344790725929185, 5.1599269009319]
ate_mse_train = [1426.6387199857252, 1426.5257760020554, 1457.5762266075928, 1403.8419027351983, 1380.1533723235652, 1423.8665005449118, 1382.2242011854964]

s_mse = [61.64265575429481, 4.709205480149645, 3.809035150594485, 3.30992270837485, 3.19204022417958, 2.9917156104816742, 3.0640986153636685]
t_mse = [35.2863445205945, 3.717996578172531, 4.343162459222803, 3.5092006227369246, 3.5157012763655286, 3.322569016601558, 3.2314446217721002]
tarnet_mse = [559.5549531257855, 21.269012117320067, 11.651497725780125, 9.040513826288347, 8.574495708466428, 7.434037707462827, 6.712915194582423]
cfr_mse = [575.5229303424774, 21.772654109165046, 11.316991072381137, 9.146503155247819, 8.526363864376831, 7.043540835032562, 6.432994400560692]
ate_mse = [1428.1536869662377, 1417.5635164351097, 1456.0197766395047, 1405.5814447907185, 1385.7603558609717, 1427.386364408164, 1376.057006798144]

s_std = [1.7522997113916199, 0.7582147497124826, 0.4031829235435906, 0.5123377891680866, 0.31850956157758203, 0.41064518447526793]

t_std = [0.4161680150704436, 1.4405940403010233, 3.293472075706411, 1.2036197400074626, 0.7096838695489651, 0.3283967927440103]

tarnet_std = [12.686423445446566, 3.49328795816114, 3.0849696133059994, 3.8511625982255993, 2.5100284425573474, 3.085098981234957]

cfr_std = [13.44896092081482, 3.8089756341203103, 3.34188655479646, 3.5273206809285704, 1.9630114938233956, 2.478329406213541]

ate_std = [678.0456330866499, 446.8774494487455, 582.7630247206414, 448.9941249876238, 439.5605165840518, 580.8644237789018]

if train:
    plt.plot(sample_sizes, s_mse_train[1:], color="C0", linestyle="--")
    plt.plot(sample_sizes, t_mse_train[1:], color="C1", linestyle="--")
    plt.plot(sample_sizes, tarnet_mse_train[1:], color="C2", linestyle="--")
    plt.plot(sample_sizes, cfr_mse_train[1:], color="C3", linestyle="--")
    # plt.plot(sample_sizes, ate_mse_train[1:], color="C4", linestyle="--")

plt.errorbar(sample_sizes, t_mse[1:], yerr=t_std, fmt='-o', capsize=5, label="T-learner", color="C1")
plt.errorbar(sample_sizes, s_mse[1:], yerr=s_std, fmt='-o', capsize=5, label="S-learner", color="C0")
plt.errorbar(sample_sizes, tarnet_mse[1:], yerr=tarnet_std, fmt='-o', capsize=5, label="TARNet", color="C2")
plt.errorbar(sample_sizes, cfr_mse[1:], yerr=cfr_std, fmt='-o', capsize=5, label="CFR", color="C3")

if log_scale:
    plt.yscale("log")

plt.legend()
leg = f"ATE estimator (MSE={np.mean(ate_mse):.2f}"
custom_line = mlines.Line2D(sample_sizes, ate_mse[1:], color='black', label=leg)
handles, labels = plt.gca().get_legend_handles_labels()
handles.append(custom_line)
labels.append(leg)
plt.legend(handles=handles, labels=labels)

y_label = " (log scale)" if log_scale else ""
plt.xticks(sample_sizes)
plt.xlabel("Sample size")
plt.ylabel(f"Average MSE{y_label}")
plt.title(f"Average MSE for different sample sizes ({sim})")
plt.savefig(f"{sim}_{y_label}.png")
plt.show()