import numpy as np
from matplotlib import pyplot as plt

from vars import *

sample_sizes = [1000, 3000, 5000, 7500, 10000, 12500, 15000][1:]
sim = "sim5"

s_mse_train = [3.922822986054694, 3.579928252160702, 3.120567743714588, 2.5154885905025477, 2.3736684781009516, 2.343133400468558, 2.312062699194691]
s_mse = [4.1033155989516645, 3.646560899941323, 3.256549336342046, 2.654137207597809, 2.445778419510104, 2.423264194316138, 2.3700897037657573]

t_mse_train = [51.234251886471874, 17.86114428876628, 15.99214914242272, 13.93042740577758, 14.549914993368603, 13.98347262339108, 12.283314466742787]
t_mse = [53.16483937236157, 17.56640957150046, 15.750501993747164, 13.626343308242763, 14.362950581976113, 13.99477247321609, 12.354750342944415]

tarnet_mse_train = [69.80523741625348, 17.163104941219878, 9.93578897201254, 6.132715983370457, 4.825351189379227, 4.46297684098152, 3.938671417952814]
tarnet_mse = [65.29408164400792, 17.05687605900463, 10.034144500086379, 6.239078906210034, 4.831557131839079, 4.50592401652481, 3.99171907929762]

cfr_mse_train = [68.86556954170184, 17.66145790599353, 9.610331110821077, 5.919873842853844, 4.852964632800379, 4.278473541920214, 3.7123827103803855]
cfr_mse = [63.8506488630728, 17.586204271119694, 9.85785453917335, 6.04868829141638, 4.926661474967366, 4.313241193646268, 3.743367847404011]

ate_mse_train = [2.001764779592676, 2.0076054739852283, 2.0058891912195222, 2.001036980800954, 2.0013142583225787, 1.9954936413751794, 1.9996605716071272]
ate_mse = [1.9790794065688981, 2.002483017616913, 1.9936048947813116, 2.01790567935273, 1.9857952503893495, 2.0016765313675804, 1.9982905141536584]

s_std = [1.0891041633197212, 0.521926873190418, 0.3550765600852884, 0.2922543141792623, 0.3756439381776769, 0.2337091100678085]

t_std = [5.931039044607818, 4.622526336072059, 6.675464683269487, 5.437503919454968, 6.759369440867927, 5.852228086303528]

tarnet_std = [6.8265686994824595, 2.2236882206727246, 2.0922045459581344, 1.5162767789384157, 1.1589291013560457, 0.8335009814504895]

cfr_std = [6.562570296426464, 2.7422139775948335, 2.136757334196227, 1.35262045974368, 1.3869141001677754, 1.0124238965132664]

ate_std = [0.1192451705069529, 0.09051695195515345, 0.07992179022018558, 0.06668502731569916, 0.05367956682569866, 0.05578829412163175]


if train:
    plt.plot(sample_sizes, s_mse_train[1:], color="C0", linestyle="--")
    plt.plot(sample_sizes, t_mse_train[1:], color="C1", linestyle="--")
    plt.plot(sample_sizes, tarnet_mse_train[1:], color="C2", linestyle="--")
    plt.plot(sample_sizes, cfr_mse_train[1:], color="C3", linestyle="--")
    # plt.plot(sample_sizes, ate_mse_train[1:], color="C4", linestyle="--")

plt.errorbar(sample_sizes, t_mse[1:], yerr=t_std, fmt='-o', capsize=5, label="T-learner", color="C1")
plt.errorbar(sample_sizes, s_mse[1:], yerr=s_std, fmt='-o', capsize=5, label="S-learner", color="C0")
plt.errorbar(sample_sizes, tarnet_mse[1:], yerr=tarnet_std, fmt='-o', capsize=5, label="TARNet", color="C2")
plt.errorbar(sample_sizes, cfr_mse[1:], yerr=cfr_std, fmt='-o', capsize=5, label="CFR", color="C3")
leg = f"ATE estimator (MSE={np.mean(ate_mse):.2f}"
plt.plot(sample_sizes, ate_mse[1:], label=leg, color="black")

if log_scale:
    plt.yscale("log")

plt.legend()
y_label = " (log scale)" if log_scale else ""
plt.xticks(sample_sizes)
plt.xlabel("Sample size")
plt.ylabel(f"Average MSE{y_label}")
plt.title(f"Average MSE for different sample sizes ({sim})")
plt.savefig(f"{sim}_{y_label}.png")
plt.show()