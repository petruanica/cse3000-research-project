import numpy as np
from matplotlib import pyplot as plt

from vars import *

sample_sizes = [1000, 3000, 5000, 7500, 10000, 12500, 15000][1:]
sim = "sim3"

s_mse_train = [2.6838432021633647, 2.208146398442347, 2.117221011467182, 2.0968160958545683, 2.0752299310726148, 2.064765825450687, 2.0631864267869435]
t_mse_train = [2.436543446637627, 2.3030849212836757, 2.2819319349464022, 2.2156229682755137, 2.1811140981285395, 2.1676718575271376, 2.1672817305942]
tarnet_mse_train = [2.3377505128561715, 2.2645753605420462, 2.228008081546308, 2.2042627363251803, 2.1744860049979184, 2.1511174890396143, 2.1520737379882093]
cfr_mse_train = [2.304388999835747, 2.2545009712989748, 2.244682688355179, 2.211130331105094, 2.1768875089633952, 2.155607615045136, 2.1429458982991987]
ate_mse_train = [3.106134447488951, 3.1183660093095735, 3.121184476857276, 3.1324256684808343, 3.1221882752867054, 3.1176449823385197, 3.1222768632273543]

s_mse = [2.796068329622883, 2.3618501296694627, 2.277429187516734, 2.186421013082558, 2.1583171798807377, 2.137065748189973, 2.1134565718938627]
t_mse = [2.799707129853626, 2.547439031578745, 2.4709080124143155, 2.350948159347746, 2.313475585656446, 2.2667605622129967, 2.251809239036992]
tarnet_mse = [3.6980490035186238, 2.734173224985891, 2.5247805586105794, 2.3885554933482687, 2.3322142395390726, 2.2771034451524805, 2.2433249291171795]
cfr_mse = [3.6721295787500794, 2.7316344664100787, 2.5444103324906995, 2.3978187603275116, 2.3382644772629217, 2.2813278708356424, 2.2317670170474435]
ate_mse = [3.0972386376229974, 3.1451272372920416, 3.1231159983852477, 3.1113207759060715, 3.125934219601679, 3.1198256640393764, 3.1338902266906543]

s_std = [0.1549184746560076, 0.1208910750010019, 0.10428801399089056, 0.06858831222537538, 0.06881314200963395, 0.06483457973823029]

t_std = [0.17162187267707854, 0.1209293599176268, 0.1238531506169187, 0.07276283770835892, 0.07942809316070812, 0.07424926694752898]

tarnet_std = [0.1953626958665925, 0.13245006905847986, 0.10726986668526453, 0.0794188561618156, 0.06939076499681171, 0.06078600076896372]

cfr_std = [0.20982406310641807, 0.1319570775637743, 0.10151143687258773, 0.08689812244895494, 0.07073278100419403, 0.06693700487183697]

ate_std = [0.22914129874725084, 0.15601406053678474, 0.13765300252124374, 0.09647911505769291, 0.11444106289657435, 0.0975867861347446]


if train:
    plt.plot(sample_sizes, s_mse_train[1:], color="C0", linestyle="--")
    plt.plot(sample_sizes, t_mse_train[1:], color="C1", linestyle="--")
    plt.plot(sample_sizes, tarnet_mse_train[1:], color="C2", linestyle="--")
    plt.plot(sample_sizes, cfr_mse_train[1:], color="C3", linestyle="--")
    # plt.plot(sample_sizes, ate_mse_train[1:], color="C4", linestyle="--")

plt.errorbar(sample_sizes, t_mse[1:], yerr=t_std, fmt='-o', capsize=5, label="T-learner", color="C1")
plt.errorbar(sample_sizes, s_mse[1:], yerr=s_std, fmt='-o', capsize=5, label="S-learner", color="C0")
plt.errorbar(sample_sizes, tarnet_mse[1:], yerr=tarnet_std, fmt='-o', capsize=5, label="TARNet", color="C2")
plt.errorbar(sample_sizes, cfr_mse[1:], yerr=cfr_std, fmt='-o', capsize=5, label="CFR", color="C3")

leg = f"ATE estimator (MSE={np.mean(ate_mse):.2f}"
plt.plot(sample_sizes, ate_mse[1:], label=leg, color="black")
if log_scale:
    plt.yscale("log")

plt.legend()
y_label = " (log scale)" if log_scale else ""
plt.xticks(sample_sizes)
plt.xlabel("Sample size")
plt.ylabel(f"Average MSE{y_label}")
plt.title(f"Average MSE for different sample sizes ({sim})")
plt.savefig(f"{sim}_{y_label}.png")
plt.show()