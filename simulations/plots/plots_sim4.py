import numpy as np
from matplotlib import pyplot as plt

from vars import *

sample_sizes = [1000, 3000, 5000, 7500, 10000, 12500, 15000][1:]
sim = "sim4"

s_mse_train = [2.183493029674396, 2.0927861683133306, 2.071720382885456, 2.071117459440719, 2.0502532641356814, 2.045377367033187, 2.0437484428427117]
s_mse = [2.2496894433796255, 2.1287882017690953, 2.114065670249876, 2.0785254869111887, 2.06982902429427, 2.0494996851637994, 2.0577703984764306]

t_mse_train = [43.486624550190555, 2.6636008051000153, 3.038322351430685, 3.1663235096611198, 2.7752416222678358, 2.9379724334763586, 2.8131917272897873]
t_mse = [44.932286432768244, 3.0153664688488004, 3.2146666828028123, 3.311295180348389, 2.8777462619472165, 3.0346720964079004, 2.9179681518435268]

tarnet_mse_train = [723.1084612084468, 12.78396982971724, 4.012318295041566, 2.7177854429231907, 2.2590406241337435, 2.230248066969558, 2.206109413959142]
tarnet_mse = [543.5573223378276, 10.785383768713773, 3.9338933466679036, 2.759935071652517, 2.2805789111026855, 2.2301370192468326, 2.2144699509452175]

cfr_mse_train = [731.6049710117787, 12.681486937741415, 3.7968702038859563, 2.694872330187609, 2.2717035469547615, 2.283417819667047, 2.2158840858815263]
cfr_mse = [559.7455026136373, 10.562930386511601, 3.7571400123183496, 2.7316199762386306, 2.291465992327987, 2.289778098565332, 2.231623058142354]

ate_mse_train = [1.996167393915872, 1.991840244725503, 1.9965206696198652, 2.0057990184151264, 1.9994128108225246, 2.0006844597973905, 2.000732942004436]
ate_mse = [1.976105221388499, 1.9837818766817166, 2.0076109374418407, 1.9883695410539417, 1.9989449351660016, 1.985901851698228, 1.9977439859001698]

s_std = [0.12485749108213288, 0.10790998319360791, 0.07807695852335331, 0.05163330003446071, 0.05778148388604232, 0.06595381450951751]

t_std = [0.2914583464736286, 0.372640663765561, 0.35464624781698606, 0.47494443291325267, 0.4786567158571409, 0.43922423468897487]

tarnet_std = [5.572609155359054, 1.1149376941034281, 0.416294161472081, 0.2424604903655848, 0.24707061177527914, 0.32415693429576625]

cfr_std = [5.867459991349804, 1.1005760203685304, 0.49028830901011716, 0.3489312678360074, 0.33881464916544385, 0.16857641861556735]

ate_std = [0.11450362495094082, 0.10205068920225073, 0.06918439067272761, 0.051795083656823386, 0.05389430015515113, 0.05446611142069497]

if train:
    plt.plot(sample_sizes, s_mse_train[1:], color="C0", linestyle="--")
    plt.plot(sample_sizes, t_mse_train[1:], color="C1", linestyle="--")
    plt.plot(sample_sizes, tarnet_mse_train[1:], color="C2", linestyle="--")
    plt.plot(sample_sizes, cfr_mse_train[1:], color="C3", linestyle="--")
    # plt.plot(sample_sizes, ate_mse_train[1:], color="C4", linestyle="--")

plt.errorbar(sample_sizes, t_mse[1:], yerr=t_std, fmt='-o', capsize=5, label="T-learner", color="C1")
plt.errorbar(sample_sizes, s_mse[1:], yerr=s_std, fmt='-o', capsize=5, label="S-learner", color="C0")
plt.errorbar(sample_sizes, tarnet_mse[1:], yerr=tarnet_std, fmt='-o', capsize=5, label="TARNet", color="C2")
plt.errorbar(sample_sizes, cfr_mse[1:], yerr=cfr_std, fmt='-o', capsize=5, label="CFR", color="C3")

leg = f"ATE estimator (MSE={np.mean(ate_mse):.2f}"
plt.plot(sample_sizes, ate_mse[1:], label=leg, color="black")

if log_scale:
    plt.yscale("log")

plt.legend()
y_label = " (log scale)" if log_scale else ""
plt.xticks(sample_sizes)
plt.xlabel("Sample size")
plt.ylabel(f"Average MSE{y_label}")
plt.title(f"Average MSE for different sample sizes ({sim})")
plt.savefig(f"{sim}_{y_label}.png")
plt.show()