import numpy as np
from matplotlib import pyplot as plt

from vars import *

sample_sizes = [1000, 3000, 5000, 7500, 10000, 12500, 15000][1:]
sim = "sim6"

s_mse_train = [1.9803048469244984, 1.9932733612086775, 2.0011104046828363, 2.003284177511002, 2.001477776975012, 2.001623518376483, 1.9951706462178869]
s_mse = [2.0273350780261277, 2.025048637256371, 2.004057199981875, 2.0160786570889577, 2.001252414622653, 2.008599634445577, 1.9997096409722075]

t_mse_train = [1.9925363396431757, 2.00983650724052, 2.0293445374117836, 2.020302962840889, 2.0187644667729376, 2.0250188820744084, 2.012034663137437]
t_mse = [2.0973089819598645, 2.086591187036302, 2.0543394583162224, 2.0482515332198736, 2.0308442603452135, 2.0395023045110916, 2.025797327157163]

tarnet_mse_train = [2.0997701982572776, 2.0265771793348804, 2.0185561172479627, 2.0154547307149384, 2.0130116205575854, 2.009031887191396, 2.000136026126552]
tarnet_mse = [3.414876631712289, 2.4148209976161255, 2.1864521359441382, 2.1345263675786783, 2.0954773336405035, 2.0795380967136703, 2.0555864689247856]

cfr_mse_train = [2.088692450723853, 2.0015345613738167, 2.018349630547156, 2.016144843176155, 2.0093992299801164, 2.007750139366246, 2.002114314592065]
cfr_mse = [3.428284609656184, 2.3871730763689545, 2.180685177000706, 2.1408461286401455, 2.0974003220671813, 2.0806828240170057, 2.061161110437542]

ate_mse_train = [1.9749975785566662, 1.9907165323637426, 1.9992258431477936, 2.0008878277295317, 1.9984065255148709, 2.0005975446172215, 1.9933407620520065]
ate_mse = [2.0001129393799926, 2.0095513791839594, 1.9952775822390563, 2.0082593705662344, 1.9928060209121055, 2.0050667534376787, 1.995964075068976]

s_std = [0.11507759305686938, 0.09990363712375953, 0.07467288191588524, 0.058403529042722, 0.046523926008210835, 0.05388088312637666]

t_std = [0.11799658856076012, 0.10532274089554217, 0.07948211398757607, 0.05913948335728261, 0.0504940345366551, 0.056905279884128905]

tarnet_std = [0.165526636858177, 0.11731490423299504, 0.08686946822594521, 0.06622718429358848, 0.05756816679030589, 0.04752958329470738]

cfr_std = [0.1630563398147777, 0.12692108049841605, 0.07960307423049379, 0.06616013859122294, 0.05429690864830323, 0.05411111170168339]

ate_std = [0.11636148300793607, 0.10041934112103305, 0.07124208242720366, 0.05644770156593181, 0.04501282782519912, 0.05079777103989086]

if train:
    plt.plot(sample_sizes, s_mse_train[1:], color="C0", linestyle="--")
    plt.plot(sample_sizes, t_mse_train[1:], color="C1", linestyle="--")
    plt.plot(sample_sizes, tarnet_mse_train[1:], color="C2", linestyle="--")
    plt.plot(sample_sizes, cfr_mse_train[1:], color="C3", linestyle="--")
    # plt.plot(sample_sizes, ate_mse_train[1:], color="C4", linestyle="--")

plt.errorbar(sample_sizes, t_mse[1:], yerr=t_std, fmt='-o', capsize=5, label="T-learner", color="C1")
plt.errorbar(sample_sizes, s_mse[1:], yerr=s_std, fmt='-o', capsize=5, label="S-learner", color="C0")
plt.errorbar(sample_sizes, tarnet_mse[1:], yerr=tarnet_std, fmt='-o', capsize=5, label="TARNet", color="C2")
plt.errorbar(sample_sizes, cfr_mse[1:], yerr=cfr_std, fmt='-o', capsize=5, label="CFR", color="C3")
leg = f"ATE estimator (MSE={np.mean(ate_mse):.2f}"
plt.plot(sample_sizes, ate_mse[1:], label=leg, color="black")

if log_scale:
    plt.yscale("log")

plt.legend()
y_label = " (log scale)" if log_scale else ""
plt.xticks(sample_sizes)
plt.xlabel("Sample size")
plt.ylabel(f"Average MSE{y_label}")
plt.title(f"Average MSE for different sample sizes ({sim})")
plt.savefig(f"{sim}_{y_label}.png")
plt.show()