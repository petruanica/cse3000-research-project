import numpy as np
from matplotlib import pyplot as plt

from vars import *

sample_sizes = [1000, 3000, 5000, 7500, 10000, 12500, 15000]
sample_sizes = sample_sizes[1:]
sim = "sim1"

s_mse_train = [10.602455453663744, 5.741132756889382, 4.231900623841184, 3.62982464620374, 3.42184785680422, 3.24545316897726, 3.175886209729362]
t_mse_train = [14.534863155805049, 13.630523420785421, 10.137547939189346, 8.118151363724342, 6.810204610967955, 6.519788161473354, 4.885180188841659]
tarnet_mse_train = [49.93984603150503, 12.60663642050772, 7.303055412569736, 5.753230400864656, 5.108163944499303, 4.815326236591142, 4.4915249344870185]
cfr_mse_train = [48.27747632044637, 12.442068318186896, 7.19153804008343, 5.672947408667833, 5.218779628826886, 4.705471949251556, 4.47546650132593]
ate_mse_train = [17.900710707151365, 17.91745625939868, 17.88766238241508, 17.912139044206253, 17.87154661477329, 17.864042360979955, 17.889925731161917]

s_mse = [10.801318887591238, 5.982023065334873, 4.357367173544492, 3.7866937018183773, 3.5287643162299993, 3.3656859665438623, 3.27670903671576]
t_mse = [15.094906480874526, 14.051626273915467, 10.409840112576914, 8.385516006740929, 6.995437877896913, 6.721185923544802, 5.076830527643476]
tarnet_mse = [49.40864711486386, 13.19965195166932, 7.627876093273807, 6.0060053521519645, 5.270949476415229, 5.004489880089936, 4.63440999972991]
cfr_mse = [47.68905778959942, 13.093066498456258, 7.55780396412233, 5.955060724895336, 5.404883951280153, 4.89597639337028, 4.616683885407382]
ate_mse = [17.890830028926754, 17.89966649063599, 17.919793432121004, 17.927593886585193, 17.851832421711123, 17.91944579861024, 17.896539710703436]

s_std = [0.7404095074085557, 0.5415052091980002, 0.3160647829678422, 0.21107211435405696, 0.18927946764180048, 0.20823806604337028]
t_std = [1.5961907812244498, 2.0021343505118705, 2.27775071849133, 2.3550285297884592, 3.8131487344532027, 2.385543407381136]
tarnet_std = [3.217252919729929, 0.7933292935161692, 0.50960034920558, 0.41997436055177667, 0.31492461576519465, 0.3262274397279967]
cfr_std = [2.2854508802789772, 0.9659280138656422, 0.5327360375755337, 0.372228773792398, 0.367976299238568, 0.27648326512607935]
ate_std = [0.4019670680851191, 0.342828054179347, 0.3144249251375005, 0.22476586623516945, 0.23153934059700937, 0.22295051199914245]

if train:
    plt.plot(sample_sizes, s_mse_train[1:], color="C0", linestyle="--")
    plt.plot(sample_sizes, t_mse_train[1:], color="C1", linestyle="--")
    plt.plot(sample_sizes, tarnet_mse_train[1:], color="C2", linestyle="--")
    plt.plot(sample_sizes, cfr_mse_train[1:], color="C3", linestyle="--")
    # plt.plot(sample_sizes, ate_mse_train[1:], color="C4", linestyle="--")

plt.errorbar(sample_sizes, t_mse[1:], yerr=t_std, fmt='-o', capsize=5, label="T-learner", color="C1")
plt.errorbar(sample_sizes, s_mse[1:], yerr=s_std, fmt='-o', capsize=5, label="S-learner", color="C0")
plt.errorbar(sample_sizes, tarnet_mse[1:], yerr=tarnet_std, fmt='-o', capsize=5, label="TARNet", color="C2")
plt.errorbar(sample_sizes, cfr_mse[1:], yerr=cfr_std, fmt='-o', capsize=5, label="CFR", color="C3")

leg = f"ATE estimator (MSE={np.mean(ate_mse):.2f}"
plt.plot(sample_sizes, ate_mse[1:], label=leg, color="black")
if log_scale:
    plt.yscale("log")

plt.legend()
y_label = " (log scale)" if log_scale else ""
plt.xticks(sample_sizes)
plt.xlabel("Sample size")
plt.ylabel(f"Average MSE{y_label}")
plt.title(f"Average MSE for different sample sizes ({sim})")
plt.savefig(f"{sim}_{y_label}.png")
plt.show()